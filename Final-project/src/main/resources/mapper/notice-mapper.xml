<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="noticeMapper">
	
	<resultMap id="noticeResultSet" type="notice">
		<result column="NOTICE_NO" property="noticeNo" />
		<result column="NOTICE_TITLE" property="noticeTitle" />
		<result column="NOTICE_CONTENT" property="noticeContent" />
		<result column="VIEWS" property="views" />
		<result column="NOTICE_CREATE_DATE" property="noticeCreateDate" />
		<result column="CATEGORY" property="category" />
		<result column="LIKE_COUNT" property="likeCount" />
		<result column="MEM_NICK" property="memNo" />
	</resultMap>	
	
	<select id="selectNoticeCount" resultType="_int">
		SELECT
		      COUNT(*)
		  FROM
		      TB_NOTICE
		 WHERE
		      STATUS = 'Y' 
	</select>
	
	<select id="selectNoticeList" resultMap="noticeResultSet">
			SELECT
			      NOTICE_NO
			     ,NOTICE_TITLE
			     ,NOTICE_CONTENT
			     ,VIEWS
			     ,TO_CHAR(NOTICE_CREATE_DATE, 'YYYY-MM-DD') AS "NOTICE_CREATE_DATE"
			     ,CATEGORY
			     ,LIKE_COUNT
			     ,MEM_NICK
			 FROM
			     TB_NOTICE
			INNER
			 JOIN
			     MEMBER ON(TB_NOTICE.MEM_NO = MEMBER.MEM_NO)
			WHERE
			     STATUS='Y'
			ORDER
			   BY
			     CATEGORY DESC, NOTICE_NO DESC
	</select>
	<select id="selectBestNotice" resultMap="noticeResultSet">
          SELECT 
			    *
			FROM
			  (SELECT
			    NOTICE_NO,
			    NOTICE_TITLE,
			    NOTICE_CONTENT,
			    VIEWS,
			    TO_CHAR(NOTICE_CREATE_DATE, 'YYYY-MM-DD') AS "NOTICE_CREATE_DATE",
			    CATEGORY,
			    LIKE_COUNT,
			    MEM_NICK
			FROM
			    TB_NOTICE
	  INNER JOIN
			    MEMBER ON (TB_NOTICE.MEM_NO = MEMBER.MEM_NO)
		   WHERE
			    STATUS = 'Y'
			    AND CATEGORY = 2
		ORDER BY
			    LIKE_COUNT DESC, NOTICE_NO DESC) b
	       WHERE 
	            ROWNUM BETWEEN 1 AND 5

	   UNION ALL
		  SELECT
		         *
			FROM(
		         SELECT
					    NOTICE_NO,
					    NOTICE_TITLE,
					    NOTICE_CONTENT,
					    VIEWS,
					    TO_CHAR(NOTICE_CREATE_DATE, 'YYYY-MM-DD') AS "NOTICE_CREATE_DATE",
					    CATEGORY,
					    LIKE_COUNT,
					    MEM_NICK
				   FROM
			            TB_NOTICE
		     INNER JOIN
			            MEMBER ON (TB_NOTICE.MEM_NO = MEMBER.MEM_NO)
			      WHERE
			            STATUS = 'Y'
			        AND 
			            CATEGORY = 1
			   ORDER BY
			            LIKE_COUNT DESC, NOTICE_NO DESC
			      ) 
			 WHERE 

				  ROWNUM BETWEEN 1 AND 5
	</select> 
	<insert id="insertNotice" parameterType="notice">
		INSERT
		  INTO
		      TB_NOTICE
		      (
			  NOTICE_NO
			 ,NOTICE_TITLE
			 ,NOTICE_CONTENT
			 ,MEM_NO
			 ,CATEGORY
			 )
	   VALUES		  
	   	     (
	   	     SEQ_NOTICE_NO.NEXTVAL
	   	    ,#{noticeTitle}
	   	    ,#{noticeContent}
	   	    ,#{memNo}
	   	    ,#{category}
	   	     )
	</insert>
<!-- 
	<insert id="insertFile" parameterType="files">
		INSERT
		  INTO
		      TB_FILE
		      (
		      FILE_NO
		     ,REF_NO
		     ,ORIGINAL_NAME
		     ,UPDATE_NAME
		     ,FILE_PATH
		     ,REF_TYPE
		     ,FILE_ANNOTATION
		      )
		VALUES
		      (
		      SEQ_FILE_NO.NEXTVAL
		     ,SEQ_NOTICE_NO.CURRVAL
		     ,#{originalName}
		     ,#{updateName}
		     ,#{filePath}
		     ,#{refType}
		     ,#{fileAnnotation}
		      )
	</insert>
 -->
</mapper>